<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ô‡∏±‡∏î ‡∏£‡∏û.‡∏ß‡∏µ‡∏£‡∏∞‡∏û‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #f0f8ff;
            --background-gradient: linear-gradient(to right, #e3f2fd, #f0f8ff);
            --card-bg: white;
            --shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            --border-radius: 20px;
            --line-color: #00c300;
            --line-hover-color: #00a000;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: var(--background-gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .form-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        @media (max-width: 576px) {
            .form-card {
                padding: 25px;
            }
        }

        h3 {
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.8rem;
        }

        .logo {
            display: block;
            margin: 0 auto 25px;
            max-width: 180px;
            height: auto;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border: none;
            padding: 12px 20px;
            font-size: 1.1rem;
            font-weight: 500;
            border-radius: 10px;
            transition: background-color 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #0b5ed7;
        }

        .btn-line {
            background-color: var(--line-color);
            color: white;
            padding: 12px 20px;
            font-size: 1.1rem;
            font-weight: 500;
            border-radius: 10px;
            transition: background-color 0.3s ease;
        }

        .btn-line:hover {
            background-color: var(--line-hover-color);
        }

        label {
            font-weight: 500;
            margin-bottom: 8px;
            color: #343a40;
        }

        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 15px;
            border: 1px solid #ced4da;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        .flatpickr-input {
            background-color: white;
        }

        .mb-3 {
            margin-bottom: 1.5rem !important;
        }
    </style>
</head>
<body>

    <div class="form-card">
        <div class="text-center mb-4">
            <img src="https://raw.githubusercontent.com/amnaj5412/appointment-form/main/logo.png"
                alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•"
                class="logo">
        </div>

        <h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ô‡∏±‡∏î ‡∏£‡∏û.‡∏ß‡∏µ‡∏£‡∏∞‡∏û‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</h3>

        <form id="bookingForm">
            <div class="mb-3">
                <label for="patientName" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</label>
                <input type="text" class="form-control" id="patientName" name="patient_name" required>
            </div>
            <div class="mb-3">
                <label for="citizenId" class="form-label">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
                <input type="text" class="form-control" id="citizenId" name="citizen_id" pattern="\d{13}" maxlength="13" required>
            </div>
            <div class="mb-3">
                <label for="phone" class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                <input type="tel" class="form-control" id="phone" name="phone" required>
            </div>
            <div class="mb-3">
                <label for="doctor" class="form-label">‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏ö</label>
                <select class="form-select" id="doctor" name="doctor" required>
                    <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                    <option>‡∏ô‡∏û.‡∏ß‡∏µ‡∏£‡∏∞‡∏û‡∏• ‡∏û‡∏à‡∏ô‡πå‡∏à‡∏•‡∏≠‡∏á‡∏®‡∏¥‡∏•‡∏õ‡πå</option>
                    <option>‡∏ô‡∏û.‡∏û‡∏ô‡∏¥‡∏ä ‡∏û‡∏à‡∏ô‡πå‡∏à‡∏•‡∏≠‡∏á‡∏®‡∏¥‡∏•‡∏õ‡πå</option>
                    <option>‡∏û‡∏ç.‡∏™‡∏∏‡∏°‡∏ì‡∏ó‡∏¥‡∏û‡∏¢‡πå ‡∏û‡∏à‡∏ô‡πå‡∏à‡∏•‡∏≠‡∏á‡∏®‡∏¥‡∏•‡∏õ‡πå</option>
                    <option>‡∏û‡∏ç.‡∏ö‡∏∏‡∏©‡∏ö‡∏á‡∏Å‡πå ‡∏î‡∏ß‡∏á‡∏°‡∏≤‡∏ï‡∏¢‡πå‡∏û‡∏•</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="dateInput" class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î</label>
                <input type="text" id="dateInput" class="form-control" name="date" required>
            </div>
            <div class="mb-3">
                <label for="time" class="form-label">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î</label>
                <select class="form-select" id="time" name="time" required>
                    <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                    <option>09:00 - 12:00</option>
                    <option>13:00 - 16:00</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary w-100 mt-3">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
        </form>

        <div class="text-center mt-4">
            <a href="https://line.me/R/ti/p/@981gqmdr" target="_blank" class="btn btn-line w-100">
                üí¨ ‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô LINE
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/th.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // Flatpickr: ‡∏û.‡∏®. (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
        flatpickr("#dateInput", {
            dateFormat: "d/m/Y",
            locale: "th",
            altInput: true,
            altFormat: "d/m/Y",
            onReady: function(selectedDates, dateStr, instance) {
                const yearElem = instance.currentYearElement;
                if (yearElem) {
                    const year = parseInt(yearElem.value);
                    if (!isNaN(year) && year < 2500) {
                        yearElem.value = year + 543;
                    }
                    yearElem.addEventListener("blur", function() {
                        let val = parseInt(this.value);
                        if (!isNaN(val)) {
                            if (val < 2400) this.value = val + 543;
                        }
                    });
                }
            },
            onChange: function(selectedDates, dateStr, instance) {
                const y = selectedDates[0].getFullYear();
                if (y < 2500) {
                    instance.currentYearElement.value = y + 543;
                }
            }
        });

        // ‡∏™‡πà‡∏ß‡∏ô JavaScript ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Apps Script (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß)
        const form = document.getElementById('bookingForm');
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö FormData
            const formData = new FormData(form);
            // ‡πÅ‡∏õ‡∏•‡∏á FormData ‡πÄ‡∏õ‡πá‡∏ô URLSearchParams string ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô application/x-www-form-urlencoded
            const params = new URLSearchParams(formData);

            // *** Web App URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì Deploy ‡∏à‡∏≤‡∏Å Apps Script) ***
            const webAppUrl = 'https://script.google.com/macros/s/AKfycbxj7xJVDW-_RorLtfiF-Mvpc298jTPifmCVl0PU-6lEuxY4OZj5A5ofVy1M4VslCk-i/exec'; 

            fetch(webAppUrl, {
                method: 'POST',
                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö x-www-form-urlencoded
                body: params.toString(), // ‡πÉ‡∏ä‡πâ toString() ‡∏Ç‡∏≠‡∏á URLSearchParams
                headers: {
                    // *** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Content-Type ‡πÄ‡∏õ‡πá‡∏ô application/x-www-form-urlencoded ***
                    'Content-Type': 'application/x-www-form-urlencoded' 
                }
            })
            .then(res => res.text()) // Apps Script ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏™‡πà‡∏á text ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
            .then(responseText => {
                if (responseText === 'success') {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏à‡∏≠‡∏á‡∏ô‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£',
                        confirmButtonColor: '#0d6efd'
                    });
                    form.reset();
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + responseText,
                        confirmButtonColor: '#d33'
                    });
                    console.error("Apps Script Response Error:", responseText);
                }
            })
            .catch((error) => {
                console.error("Fetch Error:", error);
                Swal.fire({
                    icon: 'error',
                    title: '‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå: ' + error.message,
                    confirmButtonColor: '#d33'
                });
            });
        });
    </script>
</body>
</html>
